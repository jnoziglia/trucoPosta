<html>

<head>
<script src="https://cdn.socket.io/socket.io-1.3.5.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
  var socket = io.connect('http://localhost:8080');
  socket.on('news', function (data) {
    console.log(data);
    socket.emit('my other event', { my: 'data' });
  });
  socket.on('devuelvo', function (data) {
	alert(data);
  });

  socket.on('partida', function(data) {
  	$('.juego').html('Partida creada: '+data.partida+ ', esperando jugador...');

  });

  socket.on('recargar', function(data) {
  	$(".juego").html('');
  	getPartidas();
  });

  socket.on('disconnected', function(data) {
  	alert('usuario desconectado');
  });


	function crearPartida() {
		//alert('cliquio');
		//socket.emit('partidaNueva', { msj: 'holis' });
		$.get( "/maxPartida", function( data ) {
			var num = data.numero + 1;
			console.log(data.numero);
			var partida = {fecha:Date(), player1:1, numero: num};
			$.post( "/partidas", partida )
			.done(function(data) {
				socket.emit('partidaCreada', data);
			});
		});
		
	}

	function getPartidas(){
		$.get( "/partidas", function( data ) {
	 		data.forEach(function(item){
				$('.juego').append('<div class="partida">'+item.numero+'</div>');
			});
		});
	}
  


</script>
<link rel="stylesheet" type="text/css" href="./css">
</head>
<body onload="getPartidas();">
	<a href="javascript:void(0)" onclick="logConsola()">Holis</a>
	<a href="javascript:void(0)" onclick="crearPartida()">Crear partida</a>
	<div class="juego">
		

	</div>
</body>

</html>